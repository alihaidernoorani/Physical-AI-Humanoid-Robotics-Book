---
id: ros2-nodes
title: "ROS 2 Nodes, Topics, Services, and Actions"
description: "Understanding the fundamental communication patterns in ROS 2"
personalization: true
translation: ur
learning_outcomes:
  - "Design and implement ROS 2 nodes for humanoid robot systems"
  - "Configure Quality of Service (QoS) policies for different communication patterns"
  - "Implement topic-based communication for sensor and actuator data streams"
  - "Create service-based interfaces for synchronous robot operations"
  - "Develop action-based interfaces for long-running robot behaviors"
software_stack:
  - "ROS 2 Humble Hawksbill (LTS)"
  - "Python 3.10+ with rclpy"
  - "RViz2 for visualization"
  - "Colcon for building packages"
hardware_recommendations:
  - "NVIDIA Jetson Orin Nano Development Kit"
  - "Intel RealSense D455 Depth Camera"
  - "ROS-compatible humanoid robot platform (e.g., ROSbot 2 PRO, TIAGo)"
hardware_alternatives:
  - "Raspberry Pi 4 with camera module (budget option)"
  - "Laptop with ROS 2 simulation environment"
prerequisites:
  - "Module 1 intro: Understanding ROS 2 as the robotic nervous system"
  - "Python programming fundamentals"
  - "Basic understanding of robotics concepts"
assessment_recommendations:
  - "Practical exercise: Create a simple ROS 2 node"
  - "Quiz: Identify communication patterns in given scenarios"
dependencies: ["01-ros2-nervous-system/intro"]
---

import Callout from '@site/src/components/Callout';
import Quiz from '@site/src/components/Quiz';
import Exercise from '@site/src/components/Exercise';
import Diagram from '@site/src/components/Diagram';
import Toggle from '@site/src/components/Toggle';

# ROS 2 Nodes, Topics, Services, and Actions

## Learning Objectives

- Design and implement ROS 2 nodes for humanoid robot systems
- Configure Quality of Service (QoS) policies for different communication patterns
- Implement topic-based communication for sensor and actuator data streams
- Create service-based interfaces for synchronous robot operations
- Develop action-based interfaces for long-running robot behaviors

## Understanding ROS 2 Nodes

ROS 2 nodes represent the fundamental computational units that execute specific robot functionality. In humanoid robotics, nodes encapsulate various capabilities such as sensor processing, motion control, perception, planning, and decision-making.

Each node operates as an independent process, providing fault isolation. This enables distributed computation across multiple processing unitsâ€”a critical requirement for humanoid robots with complex sensorimotor systems (Macenski, 2022).

<Callout type="note" title="Node Architecture">
The node architecture in ROS 2 differs significantly from ROS 1. It incorporates improved lifecycle management and better support for real-time systems.
</Callout>

### Concrete Examples
- Example: A humanoid robot's camera sensor node publishes images to a perception node, which then publishes detected objects to a planning node that generates navigation paths
- Example: A joint control node subscribes to desired joint angles from a motion planning node and sends commands to the robot's actuators

A ROS 2 node can be implemented in multiple languages (C++, Python, Rust, etc.). It communicates with other nodes through topics, services, and actions.

This multi-language support is particularly valuable in humanoid robotics. Different subsystems may require specialized languages for performance or legacy reasons (Rivera et al., 2020).

<Quiz
  question="Which of the following is NOT a benefit of the node-based architecture in ROS 2 for humanoid robots?"
  options={[
    "Fault isolation between different robot subsystems",
    "Distributed computation across multiple processing units",
    "Single language requirement for all robot subsystems",
    "Modular development of robot capabilities"
  ]}
  correctAnswer="Single language requirement for all robot subsystems"
  explanation="ROS 2 supports multiple programming languages, which is a benefit for humanoid robotics where different subsystems may require specialized languages for performance or legacy reasons."
/>

In humanoid robots, nodes are often organized by functional domains:

- Sensor driver nodes handle raw data acquisition from IMUs, cameras, and joint encoders
- Perception nodes process this raw data to extract meaningful information such as object locations or environment maps
- Planning nodes generate motion trajectories
- Control nodes execute these trajectories on the robot's actuators

This functional separation enables modular development and independent optimization of each subsystem (Shibata et al., 2021).

## Topic-Based Communication

Topics in ROS 2 implement a publish-subscribe communication pattern. This is ideal for sensor data distribution and state broadcasting.

In humanoid robotics, topics are commonly used for continuous data streams. These include joint states, sensor readings, and robot poses.

The asynchronous nature of topic communication allows for efficient data distribution. Multiple consumers can access the same information stream without blocking the publisher (Faconti et al., 2019).

Quality of Service (QoS) policies are a critical feature of ROS 2 topics. They allow fine-tuning of communication characteristics.

<Callout type="warning" title="QoS Criticality">
For humanoid robots, different sensor data streams require different QoS settings. For example, IMU data critical for balance control requires reliable delivery and low latency. In contrast, camera feeds for perception might tolerate best-effort delivery with higher latency.
</Callout>

QoS policies include:
- Reliability (best-effort vs. reliable)
- Durability (volatile vs. transient-local)
- History (keep-all vs. keep-last)
- Rate settings

These can be configured based on the specific requirements of each data stream (DDS, 2015).

The pub/sub pattern is particularly beneficial for humanoid robots. It naturally supports the broadcast nature of sensor data.

A single joint state publisher can provide information to multiple subscribers. These include controllers, visualizers, and logging nodes.

This reduces system complexity. It also eliminates the need for multiple direct connections between components (Macenski, 2022).

<Exercise
  title="QoS Configuration Exercise"
  problem="Configure a ROS 2 publisher for IMU data that requires reliable delivery with low latency for humanoid balance control."
  hints={[
    "Use the rclpy.qos module",
    "Set reliability to RELIABLE",
    "Set durability to VOLATILE",
    "Consider history and depth settings"
  ]}
  solution={`from rclpy.qos import QoSProfile, ReliabilityPolicy, DurabilityPolicy

# Create a QoS profile for IMU data with reliable delivery
imu_qos_profile = QoSProfile(
    depth=10,  # Keep last 10 messages
    reliability=ReliabilityPolicy.RELIABLE,  # Ensure all messages are delivered
    durability=DurabilityPolicy.VOLATILE,  # Don't keep messages for late-joining subscribers
    history=10  # Keep last 10 samples
)

# Use this profile when creating your publisher
publisher = node.create_publisher(Imu, 'imu/data', imu_qos_profile)`}
/>

## Service-Based Communication

Services provide synchronous request-response communication patterns. These are suitable for operations that require acknowledgment and result delivery.

In humanoid robotics, services are commonly used for operations that have a clear beginning and end. Examples include calibration routines, configuration changes, or state queries.

Unlike topics, services establish a direct connection between the client and server for each request. This ensures that the client receives a response to its specific request (Rivera et al., 2020).

Service-based communication is appropriate for operations that require guaranteed delivery and specific responses.

For example, a humanoid robot might use a service to request a specific joint calibration sequence. The service response indicates success or failure.

The synchronous nature of services ensures that the requesting node receives a definitive response. This is important for safety-critical operations (Shibata et al., 2021).

However, services are not suitable for continuous data streams. They're also not ideal for operations that might take extended periods to complete.

The blocking nature of service calls means that the client node waits for the response. This could cause system delays if the service takes too long to execute.

For long-running operations, actions are more appropriate (Faconti et al., 2019).

## Action-Based Communication

Actions extend services to support long-running operations. They provide feedback and goal preemption capabilities.

In humanoid robotics, actions are essential for behaviors that take extended time to complete. Examples include navigation to a goal, manipulation tasks, or complex motion sequences.

Actions provide three key communication channels:
- Goal
- Feedback
- Result

These allow clients to monitor progress and cancel operations if necessary (Macenski, 2022).

The action architecture is particularly valuable for humanoid robot behaviors. It provides a standardized interface for complex operations while allowing for interruption and recovery.

For example, a walking action might provide continuous feedback about the robot's current step phase. This allows other systems to coordinate appropriately.

If the robot detects a dangerous situation, it can preempt the walking action. It can then execute an emergency behavior (Rivera et al., 2020).

Actions use a client-server model. The action server executes the long-running behavior and the action client monitors progress.

The client can send cancel requests when needed. This design provides the flexibility needed for humanoid robot operations.

Behaviors may need to be interrupted or modified. This happens based on changing environmental conditions or higher-level planning decisions (Shibata et al., 2021).

<Quiz
  question="Which communication pattern is most appropriate for a humanoid robot's walking behavior that needs to provide continuous feedback and allow for interruption?"
  options={[
    "Topics",
    "Services",
    "Actions",
    "Parameters"
  ]}
  correctAnswer="Actions"
  explanation="Actions are specifically designed for long-running operations that provide feedback and can be preempted, making them ideal for humanoid robot behaviors like walking."
/>

## Implementation Patterns for Humanoid Robotics

In humanoid robotics, nodes are often organized using design patterns. These promote modularity and maintainability.

The component-based architecture allows nodes to be composed from smaller, reusable parts. This is particularly useful for humanoid robots that share similar functionality across different subsystems.

For example, multiple sensor drivers might share common component patterns. These are for data processing and validation (Faconti et al., 2019).

The lifecycle node pattern provides enhanced control over node initialization, configuration, and shutdown. This is important for humanoid robots that need to transition between different operational states.

Lifecycle nodes can be configured, activated, and deactivated in a controlled manner. This allows for safer robot operation and more predictable behavior during startup and shutdown sequences (DDS, 2015).

<Callout type="tip" title="Lifecycle Nodes">
Use lifecycle nodes for humanoid robot systems that need to transition between different operational states (e.g., idle, active, emergency stop) in a controlled manner.
</Callout>

## Forward References to Capstone Project

The communication patterns learned in this chapter form the foundation for the capstone project. You'll implement a complete humanoid robot system.

The node architecture you learn here will structure the perception, planning, and control systems. Understanding QoS policies will be crucial for achieving real-time performance in the final system.

The action-based patterns will be essential for implementing complex humanoid behaviors.

## Ethical & Safety Considerations

The design of communication patterns in humanoid robots has important ethical and safety implications.

The reliability of topic communication affects the consistency of sensor data. This directly impacts robot decision-making and safety.

Service calls for critical operations must be designed with appropriate timeouts and error handling. This prevents system hangs.

Actions for robot behaviors must include proper preemption capabilities. This allows for emergency stops or safety interventions (Vander Hoek et al., 2019).

<Callout type="danger" title="Safety Critical">
For safety-critical operations in humanoid robots, always implement proper error handling, timeouts, and preemption capabilities to ensure safe robot operation.
</Callout>

## Key Takeaways

- Nodes provide the fundamental computational units for robot functionality with improved lifecycle management over ROS 1
- Topics enable efficient publish-subscribe communication with configurable Quality of Service policies
- Services provide synchronous request-response communication for operations requiring acknowledgment
- Actions support long-running operations with feedback and preemption capabilities
- Proper selection of communication patterns is critical for humanoid robot performance and safety
- QoS policies allow fine-tuning of communication characteristics for specific robot requirements

## References

DDS. (2015). *Data Distribution Service (DDS) for Real-Time Systems*. Object Management Group.

Faconti, N., Paluri, M., & Breyer, M. (2019). *ROS 2 Design: client library architecture*. IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS).

Macenski, S. (2022). *Real-time performance in ROS 2*. Journal of Software Engineering for Robotics, 13(1), 45-62.

Rivera, S. S., Leturc, I., Rodriguez-Araujo, J., & Bouchard, M. (2020). ROS and ROS 2 compared in a real-time and distributed system for industrial applications. IEEE International Conference on Industrial Technology (ICIT), 1134-1139.

Shibata, H., Saito, T., & Sato, M. (2021). Distributed robotic systems using ROS 2: Architecture and applications. Advanced Robotics, 35(8), 467-482.

Vander Hoek, K., Hart, S., Belpaeme, T., & Feil-Seifer, D. (2019). Socially assistive robotics: A focus on trust and trustworthiness. IEEE International Conference on Robotics and Automation (ICRA), 8374-8380.