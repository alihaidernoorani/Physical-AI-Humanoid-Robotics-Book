"use strict";(globalThis.webpackChunktextbook_physical_ai=globalThis.webpackChunktextbook_physical_ai||[]).push([[966],{7585(e,t,s){s.d(t,{default:()=>y});var a=s(6540),n=s(4848);const i=({message:e})=>{const{text:t,sender:s,timestamp:a,citations:i}=e;return(0,n.jsxs)("div",{className:`message message--${s}`,children:[(0,n.jsxs)("div",{className:"message__content",children:[(0,n.jsx)("div",{className:"message__text",children:t}),i&&i.length>0&&(0,n.jsx)("div",{className:"message__citations",children:(0,n.jsxs)("details",{children:[(0,n.jsx)("summary",{children:"Citations"}),(0,n.jsx)("ul",{children:i.map((e,t)=>(0,n.jsx)("li",{children:e},t))})]})})]}),(0,n.jsx)("div",{className:"message__meta",children:(0,n.jsx)("span",{className:"message__time",children:(e=>{if(!e)return"";return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})(a)})})]})},r=({messages:e=[]})=>(0,n.jsx)("div",{className:"message-list",children:0===e.length?(0,n.jsx)("div",{className:"empty-state",children:(0,n.jsx)("p",{children:"Start a conversation by sending a message below!"})}):e.map(e=>(0,n.jsx)(i,{message:e},e.id||e.timestamp))}),o=({onSendMessage:e,isLoading:t=!1})=>{const[s,i]=(0,a.useState)("");return(0,n.jsx)("form",{className:"message-input",onSubmit:a=>{a.preventDefault(),s.trim()&&!t&&(e(s),i(""))},children:(0,n.jsxs)("div",{className:"message-input__container",children:[(0,n.jsx)("textarea",{value:s,onChange:e=>i(e.target.value),onKeyPress:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),s.trim()&&!t&&(e(s),i("")))},placeholder:"Type your message here...",disabled:t,rows:3}),(0,n.jsx)("button",{type:"submit",disabled:t||!s.trim(),className:"message-input__send-button",children:t?"Sending...":"Send"})]})})},c=({error:e,onRetry:t=null,showRetry:s=!0})=>e?(0,n.jsx)("div",{className:"error-display",children:(0,n.jsxs)("div",{className:"error-display__content",children:[(0,n.jsx)("div",{className:"error-display__icon",children:"\u26a0\ufe0f"}),(0,n.jsxs)("div",{className:"error-display__message",children:[(0,n.jsx)("h4",{children:"Error"}),(0,n.jsx)("p",{children:e.message||e||"An unknown error occurred"})]}),t&&s&&(0,n.jsx)("button",{className:"error-display__retry-button",onClick:t,children:"Retry"})]})}):null,l=process.env.REACT_APP_API_BASE_URL||"https://alihaidernoorani-deploy-docusaurus-book.hf.space/api",d=async(e,t={})=>{const s=`${l}${e}`,a={headers:{"Content-Type":"application/json",...t.headers},...t},n=localStorage.getItem("auth_token");n&&(a.headers.Authorization=`Bearer ${n}`);try{const e=await fetch(s,a);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(i){throw console.error("API Error:",i),i}},h=async e=>{try{return await d("/chat",{method:"POST",body:JSON.stringify(e)})}catch(t){throw console.error("Error sending chat message:",t),t}},m=async e=>{try{return await d(`/chat/history/${e}`,{method:"GET"})}catch(t){throw console.error("Error getting chat history:",t),t}},u=async e=>{try{return await d("/chat/session",{method:"POST",body:JSON.stringify(e)})}catch(t){throw console.error("Error creating chat session:",t),t}},g=({sessionId:e=null,initialMessages:t=[],onSendMessage:s,isLoading:i,error:l})=>{const[d,g]=(0,a.useState)(t),[y,p]=(0,a.useState)(i||!1),[S,x]=(0,a.useState)(l||null),[w,_]=(0,a.useState)("connected"),[j,v]=(0,a.useState)(e);(0,a.useEffect)(()=>{j||f(),b();const e=setInterval(b,3e4);return()=>clearInterval(e)},[]);const b=async()=>{try{_("connecting"),await m("test"),_("connected")}catch(e){_("disconnected"),console.error("Connection check failed:",e)}},f=async()=>{try{const e=await u({timestamp:(new Date).toISOString(),metadata:{type:"chat"}});v(e.session_id)}catch(e){console.error("Error creating session:",e),x("Failed to create chat session")}};return(0,n.jsxs)("div",{className:"chat-window",children:[(0,n.jsxs)("div",{className:"chat-header",children:[(0,n.jsx)("h3",{children:"AI Chat Assistant"}),(0,n.jsx)("div",{className:`connection-status connection-status--${w}`,children:"connected"===w?"\u25cf Connected":"connecting"===w?"\u25cb Connecting...":"\u25cb Disconnected"})]}),S&&(0,n.jsx)(c,{error:{message:S},onRetry:()=>{x(null),b()}}),(0,n.jsx)(r,{messages:d}),(0,n.jsx)(o,{onSendMessage:async e=>{if(!e.trim()||y)return;if(s)return void s(e);const t={id:Date.now(),text:e,sender:"user",timestamp:(new Date).toISOString()};g(e=>[...e,t]),p(!0),x(null);try{const t=new Promise((e,t)=>setTimeout(()=>t(new Error("Request timeout")),3e4)),s=h({query:e,session_id:j}),a=await Promise.race([s,t]),n={id:Date.now()+1,text:a.response||a.answer||"No response",sender:"bot",timestamp:(new Date).toISOString(),citations:a.citations||[]};g(e=>[...e,n])}catch(a){console.error("Error sending message:",a),"Request timeout"===a.message?x("Request timed out. Please try again."):x("Failed to send message. Please try again.");const e={id:Date.now()+1,text:"Sorry, I encountered an error. Please try again.",sender:"system",timestamp:(new Date).toISOString()};g(t=>[...t,e])}finally{p(!1)}},isLoading:y})]})},y=({initialMessages:e=[],sessionId:t=null,showChat:s=!0})=>{const[i,r]=(0,a.useState)(e),[o,c]=(0,a.useState)(null),[l,d]=(0,a.useState)(s),[m,y]=(0,a.useState)(!1),[p,S]=(0,a.useState)(!1),[x,w]=(0,a.useState)(null);(0,a.useEffect)(()=>{if("undefined"!=typeof window){if(t)c(t);else{const e=localStorage.getItem("chat_session_id");e&&c(e)}const e=localStorage.getItem("chatkit_visibility");null!==e&&d("true"===e),y(!0)}},[t]),(0,a.useEffect)(()=>(m&&(async()=>{if(!o&&m)try{const e=(await u({timestamp:(new Date).toISOString(),metadata:{type:"global-chat"}})).session_id;c(e),localStorage.setItem("chat_session_id",e)}catch(e){console.error("Error creating session:",e),w("Failed to initialize chat session")}})(),()=>{i.length>0&&localStorage.setItem("chat_messages",JSON.stringify(i))}),[o,m]);const _=()=>{const e=!l;d(e),"undefined"!=typeof window&&localStorage.setItem("chatkit_visibility",e.toString())};return(0,n.jsx)("div",{className:"chatkit-container "+(l?"chatkit-visible":"chatkit-hidden"),children:l?(0,n.jsxs)("div",{className:"chatkit-wrapper",children:[(0,n.jsxs)("div",{className:"chatkit-header",children:[(0,n.jsx)("h3",{children:"AI Chat Assistant"}),(0,n.jsx)("button",{className:"chatkit-toggle-btn",onClick:_,"aria-label":"Minimize chat",children:"\u2212"})]}),(0,n.jsx)(g,{sessionId:o,initialMessages:i,onSendMessage:async e=>{if(e.trim()&&!p&&o)try{S(!0),w(null);const t={id:Date.now(),text:e,sender:"user",timestamp:(new Date).toISOString()};r(e=>[...e,t]);const s=await h({query:e,session_id:o}),a={id:Date.now()+1,text:s.response||s.answer||"No response received",sender:"bot",timestamp:(new Date).toISOString(),citations:s.citations||[]};r(e=>[...e,a])}catch(t){console.error("Error sending message:",t),"Request timeout"===t.message?w("Request timed out. Please try again."):w("Failed to send message. Please try again.");const e={id:Date.now()+1,text:"Sorry, I encountered an error. Please try again.",sender:"system",timestamp:(new Date).toISOString()};r(t=>[...t,e])}finally{S(!1)}},isLoading:p,error:x})]}):(0,n.jsx)("button",{className:"chatkit-open-btn",onClick:_,"aria-label":"Open chat",children:"\ud83d\udcac Chat"})})}}}]);